# PriceMonitoringService

## Описание

**PriceMonitoringService** — это сервис на базе .NET, предназначенный для отслеживания и анализа цен. Он использует шаблон веб-приложения ASP.NET (Web API) и организован по многослойной архитектуре для упрощения поддержки и масштабирования.

## Архитектура и принципы

Проект следует многослойной архитектуре (Layered Architecture):

1. **Слой контроллеров (Controllers)**  
   - Отвечает за приём и обработку входящих HTTP-запросов (REST API).  
   - Делегирует работу сервисному слою, а затем возвращает ответы клиенту.

2. **Сервисный слой (Service)**  
   - Содержит бизнес-логику: обработка данных, валидация, вызов методов репозиториев, интеграция с внешними сервисами.  
   - Служит прослойкой между контроллерами и уровнем доступа к данным.

3. **Слой данных (Data)**  
   - Управляет доступом к базе данных.  
   - Содержит контекст EF Core (`DbContext`), репозитории (если используются) и классы для миграций (папка Migrations).

4. **База данных**  
   - Хранит основные данные (информация о подписках пользователя).

## Принятые допущения

1. **отправка по почте **
   - для того чтобы отправлять данные по почте, нужно указать конкретные данные отправителя в коде или задать в качестве переменной окружения
2. **парсинг HTML**
   - не получилось расшифровать на какой API идут запросы, поэтому воспользовался парсингом напрямую из html

## Как запустить

### Локальный запуск

1. Убедитесь, что у вас установлен .NET 6 или более поздняя версия.  
2. Выполните в корневой папке:
   ```bash
   dotnet build
   dotnet run
### Docker
1. docker pull maxkedroff2005/monitoringservice
2. docker run maxkedroff2005/monitoringservice

## схема API

## Описание

**SubscriptionController** отвечает за создание подписок и получение списка цен. Контроллер предоставляет два эндпоинта:

1. **POST** `/api/Subscription` — создаёт новую подписку, принимая `Url` и `Email`.
2. **GET** `/api/Subscription/prices` — возвращает список всех подписок, включая URL, последнюю зафиксированную цену и дату последней проверки.

Сервис работает на сервере:
- `http://localhost:5176`
  
## Пример запросов

### 1. Создать новую подписку

**Метод:** POST  
**URL:** `http://localhost:5176/api/Subscription`

- **Тело запроса (JSON):**

  ```json
  {
    "url": "https://example.com/product/123",
    "email": "user@example.com"
  }

- ** пример успешного ответа **
  ```json
  {
  "id": 1,
  "url": "https://example.com/product/123",
  "email": "user@example.com",
  "lastPrice": null,
  "lastChecked": "2025-01-01T12:00:00Z"
  }
- ** пример ошибки **
  ```json
  {
  "error": "необходимо передать Url и Email"
  }
  
### 2. посмотреть все подписки
**Метод:** GET  
**URL:** `http://localhost:5176/api/Subscription/prices`

- ** пример успешного ответа **
  ```json
  [
  {
    "url": "https://example.com/product/123",
    "lastPrice": 99.99,
    "lastChecked": "2025-01-01T12:00:00Z"
  },
  {
    "url": "https://example.com/product/456",
    "lastPrice": 149.99,
    "lastChecked": "2025-02-01T09:30:00Z"
  }]





